from FireApi.modules import PyModules
from FireApi.response import Response
from FireApi.request import Request


struct Client:
    var _modules: PyModules
    var _client_socket: PythonObject
    var _host_name: StringLiteral
    var _port: Int

    fn __init__(inout self, host_name: StringLiteral, port: Int) raises -> None:
        self._modules = PyModules()
        self._client_socket = self._modules.socket.socket()
        self._host_name = host_name
        self._port = port

    fn send_request(borrowed self, request: Request) raises -> Response:
        _ = self._client_socket.connect((self._host_name, self._port))
        let request_bytes = request.to_bytes(
            py_builtins=self._modules.py,
        )

        _ = self._client_socket.send(request_bytes.encode())
        let raw_response = self._client_socket.recv(1024).decode()
        print(raw_response)

        _ = self._client_socket.close()

        return Response(
            status_code=200,
            body=str(raw_response),
        )

