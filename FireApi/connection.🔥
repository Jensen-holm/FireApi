from python import PythonObject
from FireApi.response import Response


struct Connection:
    var conn: PythonObject
    var addr: PythonObject
    var _py: PythonObject

    fn __init__(inout self, conn_addr: PythonObject, py: PythonObject) raises -> None:
        self.conn = conn_addr[0]
        self.addr = conn_addr[1]
        self._py = py

    fn recieve_data(self, size: Int = 1024) raises -> String:
        let data = self.conn.recv(size).decode("utf-8")
        return data.__str__()

    fn send_response(self, response: Response) raises -> None:
        let response_bytes = response.to_bytes(py_builtins=self._py)
        _ = self.conn.sendall(response_bytes)

    fn close(self) raises -> None:
        _ = self.conn.close()

    fn __str__(self) raises -> String:
        return str(self.conn) + str(self.addr)
